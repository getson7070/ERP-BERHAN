<!doctype html>
<html lang="en" data-theme="light" data-contrast="normal">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0b1120" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#f4f7fb" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#f4f7fb" data-dynamic-theme />
  <title>{% block title %}ERP{% endblock %}</title>
  <script>
    (function () {
      const root = document.documentElement;
      const keys = { theme: "erp-ui-theme", contrast: "erp-ui-contrast" };

      let storage;
      try {
        storage = window.localStorage;
        const testKey = "__erp-ui-check__";
        storage.setItem(testKey, testKey);
        storage.removeItem(testKey);
      } catch (error) {
        storage = null;
      }

      const getStored = (key) => (storage ? storage.getItem(key) : null);
      const prefersDark =
        window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)");
      const prefersHighContrast =
        window.matchMedia && window.matchMedia("(prefers-contrast: more)");
      const forcedColors =
        window.matchMedia && window.matchMedia("(forced-colors: active)");

      const setThemeColor = (theme) => {
        const meta = document.querySelector('meta[data-dynamic-theme]');
        if (!meta) return;
        meta.setAttribute('content', theme === "dark" ? "#0b1120" : "#f4f7fb");
      };

      const initialTheme = getStored(keys.theme)
        || (prefersDark && prefersDark.matches ? "dark" : "light");
      root.setAttribute("data-theme", initialTheme === "dark" ? "dark" : "light");
      setThemeColor(initialTheme);

      if (forcedColors && forcedColors.matches) {
        root.setAttribute("data-contrast", "high");
        return;
      }

      const initialContrast = getStored(keys.contrast)
        || (prefersHighContrast && prefersHighContrast.matches ? "high" : "normal");
      root.setAttribute(
        "data-contrast",
        initialContrast === "high" ? "high" : "normal",
      );
    })();
  </script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}" />
  {% block head %}{% endblock %}
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <header class="app-header" role="banner">
    <div class="app-header__inner">
      <div class="app-brand">
        <span class="app-brand__mark" aria-hidden="true"></span>
        <div class="app-brand__text">
          <span class="app-brand__title">ERP Berhan</span>
          <span class="app-brand__tagline">Secure operations platform</span>
        </div>
      </div>
      <div class="app-toolbar" role="group" aria-label="Display preferences">
        <button
          type="button"
          class="toolbar-btn"
          data-theme-toggle
          data-dark-label="Switch to light mode"
          data-dark-text="Dark mode"
          data-dark-status="Dark theme enabled"
          data-light-label="Switch to dark mode"
          data-light-text="Light mode"
          data-light-status="Light theme enabled"
          aria-pressed="false"
          aria-label="Switch to dark mode"
          aria-describedby="theme-preference-status"
        >
          <span class="toolbar-btn__icon" aria-hidden="true"></span>
          <span class="toolbar-btn__text">Theme</span>
          <span
            class="visually-hidden"
            id="theme-preference-status"
            data-theme-status
            aria-live="polite"
            role="status"
          >Light theme enabled</span>
        </button>
        <button
          type="button"
          class="toolbar-btn"
          data-contrast-toggle
          data-on-label="Disable high contrast"
          data-on-text="High contrast on"
          data-on-status="High contrast mode enabled"
          data-off-label="Enable high contrast"
          data-off-text="High contrast"
          data-off-status="Standard contrast mode enabled"
          data-forced-label="High contrast managed by your system settings"
          data-forced-text="High contrast (system)"
          data-forced-status="High contrast is enforced by your system preferences"
          aria-pressed="false"
          aria-label="Enable high contrast"
          aria-describedby="contrast-preference-status"
        >
          <span class="toolbar-btn__icon toolbar-btn__icon--contrast" aria-hidden="true"></span>
          <span class="toolbar-btn__text">High contrast</span>
          <span
            class="visually-hidden"
            id="contrast-preference-status"
            data-contrast-status
            aria-live="polite"
            role="status"
          >Standard contrast mode enabled</span>
        </button>
        <p
          class="toolbar-note"
          id="contrast-forced-note"
          data-contrast-forced-note
          hidden
        >
          High contrast is currently controlled by your operating system preferences.
        </p>
      </div>
    </div>
  </header>
  <noscript>
    <div class="noscript-banner" role="alert">
      <p>
        Display preferences such as dark mode and high contrast need JavaScript to save your
        choices. Enable JavaScript for the best experience.
      </p>
    </div>
  </noscript>
  <main id="main-content" class="app-main" tabindex="-1">
    <div class="wrap">
      <div class="card{% block card_class %}{% endblock %}">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="alerts" role="status" aria-live="polite">
              {% for category, message in messages %}
                <div class="alert alert--{{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        {% block content %}{% block body %}{% endblock %}{% endblock %}
      </div>
    </div>
  </main>
  <footer class="app-footer" role="contentinfo">
    <div class="app-footer__inner">
      <p class="app-footer__copy">Built for performance, accessibility, and trust.</p>
    </div>
  </footer>
  <script src="{{ url_for('static', filename='js/theme-preferences.js') }}" defer></script>
</body>
</html>
