{% extends "base_auth.html" %}
{% block title %}Client Registration{% endblock %}
{% block content %}
<h2 class="mb-4 text-center">Client Registration</h2>
{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-danger">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}
<form method="POST" class="needs-validation" novalidate>
    {{ form.hidden_tag() }}
    <div class="mb-3">
        {{ form.tin.label(class="form-label") }}
        {{ form.tin(class="form-control", id="tin", placeholder="Enter TIN", required=True) }}
        <div class="invalid-feedback">TIN is required.</div>
    </div>
    <div class="mb-3">
        {{ form.institution_name.label(class="form-label") }}
        {{ form.institution_name(class="form-control", id="institution_name", placeholder="Institution Name", required=True) }}
        <div class="invalid-feedback">Institution name is required.</div>
    </div>
    <div class="mb-3">
        {{ form.address.label(class="form-label") }}
        {{ form.address(class="form-control", id="address", placeholder="Address", required=True) }}
        <div class="invalid-feedback">Address is required.</div>
    </div>
    <div class="mb-3">
        {{ form.phone.label(class="form-label") }}
        {{ form.phone(class="form-control", id="phone", placeholder="Phone Number", required=True) }}
        <div class="invalid-feedback">Phone number is required.</div>
    </div>
    <div class="mb-3">
        {{ form.region.label(class="form-label") }}
        {{ form.region(class="form-select", id="region", required=True) }}
        <div class="invalid-feedback">Region is required.</div>
    </div>
    <div class="mb-3">
        {{ form.city.label(class="form-label") }}
        {{ form.city(class="form-select", id="city", required=True) }}
        <div class="invalid-feedback">City is required.</div>
    </div>
    <div class="mb-3">
        {{ form.email.label(class="form-label") }}
        {{ form.email(class="form-control", id="email", placeholder="Email", required=True) }}
        <div class="invalid-feedback">Valid email is required.</div>
    </div>
    <div class="mb-3">
        {{ form.password.label(class="form-label") }}
        {{ form.password(class="form-control", id="password", placeholder="Password", required=True, minlength=8) }}
        <div class="invalid-feedback">Password must be at least 8 characters.</div>
    </div>
    {{ form.submit(class="btn btn-primary w-100") }}
    <a href="{{ url_for('auth.choose_login') }}" class="btn btn-secondary w-100 mt-2">Back</a>
</form>
{% endblock %}
{% block scripts %}
<script>
    function loadCities(region) {
        fetch(`/get_cities?region=${encodeURIComponent(region)}`)
            .then(response => response.json())
            .then(data => {
                const citySelect = document.getElementById('city');
                citySelect.innerHTML = '';
                data.cities.forEach(city => {
                    const opt = document.createElement('option');
                    opt.value = city;
                    opt.textContent = city;
                    citySelect.appendChild(opt);
                });
            });
    }
    const regionSelect = document.getElementById('region');
    regionSelect.addEventListener('change', () => loadCities(regionSelect.value));
    window.addEventListener('load', () => loadCities(regionSelect.value));
</script>
{% endblock %}
