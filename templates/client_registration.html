{% extends "base.html" %}
{% block title %}Client Registration{% endblock %}
{% block body %}
<div class="container py-5">
<div class="container mt-5">
        <h2>Client Registration</h2>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-danger">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form method="POST" class="needs-validation" novalidate>
            {{ form.hidden_tag() }}
            <div class="mb-3">
                {{ form.tin.label(class="form-label") }}
                {{ form.tin(class="form-control", id="tin") }}
            </div>
            <div class="mb-3">
                {{ form.institution_name.label(class="form-label") }}
                {{ form.institution_name(class="form-control", id="institution_name") }}
            </div>
            <div class="mb-3">
                {{ form.address.label(class="form-label") }}
                {{ form.address(class="form-control", id="address") }}
            </div>
            <div class="mb-3">
                {{ form.phone.label(class="form-label") }}
                {{ form.phone(class="form-control", id="phone") }}
            </div>
            <div class="mb-3">
                {{ form.region.label(class="form-label") }}
                {{ form.region(class="form-select", id="region") }}
            </div>
            <div class="mb-3">
                {{ form.city.label(class="form-label") }}
                {{ form.city(class="form-select", id="city") }}
            </div>
            <div class="mb-3">
                {{ form.email.label(class="form-label") }}
                {{ form.email(class="form-control", id="email") }}
            </div>
            <div class="mb-3">
                {{ form.password.label(class="form-label") }}
                {{ form.password(class="form-control", id="password") }}
            </div>
            {{ form.submit(class="btn btn-primary") }}
            <a href="{{ url_for('auth.choose_login') }}" class="btn btn-secondary ms-2">Back</a>
        </form>
    </div>
    <script>
        function loadCities(region) {
            fetch(`/get_cities?region=${encodeURIComponent(region)}`)
                .then(response => response.json())
                .then(data => {
                    const citySelect = document.getElementById('city');
                    citySelect.innerHTML = '';
                    data.cities.forEach(city => {
                        const opt = document.createElement('option');
                        opt.value = city;
                        opt.textContent = city;
                        citySelect.appendChild(opt);
                    });
                });
        }
        const regionSelect = document.getElementById('region');
        regionSelect.addEventListener('change', () => loadCities(regionSelect.value));
        window.addEventListener('load', () => loadCities(regionSelect.value));
    </script>
</div>
{% endblock %}
