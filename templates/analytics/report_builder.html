{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Report Builder</h2>
  <form method="post" class="row g-3" id="report-form">
    <div class="col-md-4">
      <label for="report_type" class="form-label">Report Type</label>
      <select class="form-select" id="report_type" name="report_type" required>
        <option value="orders">Orders</option>
        <option value="tenders">Tenders</option>
      </select>
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary">Generate</button>
    </div>
  </form>
  <div id="field-palette" class="mt-3">
    <span class="badge bg-secondary me-2 draggable" draggable="true">id</span>
    <span class="badge bg-secondary me-2 draggable" draggable="true">status</span>
  </div>
  {% if rows %}
  <div class="mt-4">
    <form method="post" action="{{ url_for('analytics.export_report', fmt='excel') }}" class="d-inline">
      <input type="hidden" name="report_type" value="{{ request.form.report_type }}">
      <button class="btn btn-sm btn-success">Export Excel</button>
    </form>
    <form method="post" action="{{ url_for('analytics.export_report', fmt='pdf') }}" class="d-inline ms-2">
      <input type="hidden" name="report_type" value="{{ request.form.report_type }}">
      <button class="btn btn-sm btn-danger">Export PDF</button>
    </form>
    <table class="table table-striped mt-3" id="report-table">
      <thead>
        <tr>
          {% for header in headers %}
          <th class="draggable" draggable="true">{{ header }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          {% for cell in row %}
          <td>{{ cell }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if anomalies %}
    <div class="alert alert-warning">Anomalies detected: {{ anomalies }}</div>
    {% endif %}
  </div>
  {% endif %}
</div>
<script>
document.querySelectorAll('.draggable').forEach(el=>{
  el.addEventListener('dragstart', e=>{e.dataTransfer.setData('text/plain', e.target.textContent);});
});
</script>
{% endblock %}
