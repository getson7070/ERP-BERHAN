{% extends "base.html" %}
{% block title %}Inventory{% endblock %}
{% block body %}
<div class="container py-5" role="main">
  {% set crumbs=[{'title': _('Home'), 'url': url_for('dashboard')}, {'title': _('Inventory')}] %}
  {% include 'partials/breadcrumbs.html' %}
  <h1 class="mb-4">Inventory {% include 'partials/help_tooltip.html' %}</h1>
  {% include 'partials/saved_views.html' %}
  <div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead><tr><th scope="col">Name</th><th scope="col">Quantity</th><th></th></tr></thead>
    <tbody>
      {% for item in items %}
      <tr data-id="{{ item.id }}">
        <td><input class="form-control name" value="{{ item.name }}"></td>
        <td><input class="form-control quantity" type="number" value="{{ item.quantity }}"></td>
        <td><button class="btn btn-sm btn-primary save">Save</button></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/saved_views.js') }}"></script>
  <script>
  document.querySelectorAll('.save').forEach(btn => {
    btn.addEventListener('click', async e => {
      const row = e.target.closest('tr');
      const id = row.getAttribute('data-id');
      const name = row.querySelector('.name').value;
      const quantity = row.querySelector('.quantity').value;
      const form = new FormData();
      form.append('name', name);
      form.append('quantity', quantity);
      try {
        const resp = await fetch(`/inventory/${id}`, {
          method: 'POST',
          body: form
        });
        if (resp.ok) {
          showMessage('success', '{{ _('Saved') }}');
        } else {
          showMessage('danger', '{{ _('Save failed') }}');
        }
      } catch (err) {
        showMessage('danger', '{{ _('Save failed') }}');
      }
    });
  });
  </script>
{% endblock %}
