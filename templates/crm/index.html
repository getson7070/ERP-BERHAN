{% extends 'base.html' %}
{% block title %}Customers{% endblock %}
{% block content %}
<style>
  :focus { outline: 2px dashed #4f46e5; outline-offset: 2px; }
  .table-sticky thead th { position: sticky; top: 0; background: #fff; }
</style>
<div class="container py-5">
  <h2>Customers</h2>
  <div class="mb-2">
    <span class="me-2">Columns:</span>
    <input type="checkbox" id="col-id" class="col-toggle" data-col="0" checked>
    <label for="col-id" class="me-2">ID</label>
    <input type="checkbox" id="col-name" class="col-toggle" data-col="1" checked>
    <label for="col-name" class="me-2">Name</label>
  </div>
  <p>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('crm.export_customers_csv', sort=sort, dir=direction) }}">CSV</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('crm.export_customers_xlsx', sort=sort, dir=direction) }}">XLSX</a>
  </p>
  <div class="table-responsive">
  <table class="table table-striped table-sticky">
    <thead>
      <tr>
        <th aria-sort="{{ 'ascending' if sort=='id' and direction=='asc' else 'descending' if sort=='id' and direction=='desc' else 'none' }}">
          <a href="{{ url_for('crm.index', sort='id', dir='desc' if sort=='id' and direction=='asc' else 'asc', offset=offset, limit=limit) }}">ID{% if sort=='id' %}{% if direction=='asc' %} ▲{% else %} ▼{% endif %}{% endif %}</a>
        </th>
        <th aria-sort="{{ 'ascending' if sort=='name' and direction=='asc' else 'descending' if sort=='name' and direction=='desc' else 'none' }}">
          <a href="{{ url_for('crm.index', sort='name', dir='desc' if sort=='name' and direction=='asc' else 'asc', offset=offset, limit=limit) }}">Name{% if sort=='name' %}{% if direction=='asc' %} ▲{% else %} ▼{% endif %}{% endif %}</a>
        </th>
      </tr>
    </thead>
    <tbody>
      {% for c in customers %}
      <tr><td>{{ c[0] }}</td><td>{{ c[1] }}</td></tr>
      {% else %}
      <tr><td colspan="2">No customers</td></tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  <nav>
    <ul class="pagination">
      {% if prev_offset is not none %}
      <li class="page-item"><a class="page-link" href="{{ url_for('crm.index', offset=prev_offset, limit=limit, sort=sort, dir=direction) }}">Previous</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}
      {% if next_offset is not none %}
      <li class="page-item"><a class="page-link" href="{{ url_for('crm.index', offset=next_offset, limit=limit, sort=sort, dir=direction) }}">Next</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
  <a href="{{ url_for('crm.add_customer') }}" class="btn btn-primary">Add Customer</a>
</div>
<script>
  document.querySelectorAll('.col-toggle').forEach(cb => {
    cb.addEventListener('change', () => {
      const idx = parseInt(cb.dataset.col);
      document.querySelectorAll('.table tr').forEach(row => {
        const cell = row.children[idx];
        if(cell){ cell.style.display = cb.checked ? '' : 'none'; }
      });
    });
  });
</script>
{% endblock %}
